
admin_html = '''<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel â€“ Five Roam Coffee</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Lato:wght@300;400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root {
      --beige:#f5f0e8; --beige-dark:#e8dfc8; --beige-mid:#ede4d0;
      --brown:#3e2a1a; --brown-light:#6b4226;
      --gold:#b8860b; --gold-light:#d4a843; --accent:#8b5e3c;
      --text:#2c1a0e; --text-light:#6b5040; --white:#fffdf8;
      --shadow:rgba(62,42,26,0.12); --success:#2a8c4a; --danger:#cc3333;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Lato',sans-serif; background:#1a0f07; color:var(--text); min-height:100vh; }

    /* LOGIN */
    #login-screen { min-height:100vh; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,#1a0f07,#3e2a1a); }
    .login-box { background:var(--white); border-radius:20px; padding:44px 40px; max-width:400px; width:100%; box-shadow:0 20px 60px rgba(0,0,0,0.4); }
    .login-logo { font-family:'Playfair Display',serif; font-size:1.6rem; color:var(--brown); text-align:center; margin-bottom:6px; }
    .login-logo span { color:var(--gold); }
    .login-sub { text-align:center; color:var(--text-light); font-size:0.85rem; margin-bottom:32px; }
    .form-group { margin-bottom:18px; }
    .form-group label { display:block; font-size:0.82rem; font-weight:600; color:var(--brown-light); margin-bottom:7px; text-transform:uppercase; letter-spacing:0.5px; }
    .form-control { width:100%; padding:11px 14px; border:2px solid var(--beige-dark); border-radius:10px; font-family:'Lato',sans-serif; font-size:0.95rem; color:var(--text); background:var(--beige); outline:none; transition:border-color 0.2s; }
    .form-control:focus { border-color:var(--gold); }
    .login-btn { width:100%; background:var(--brown); color:var(--white); border:none; border-radius:24px; padding:13px; font-family:'Playfair Display',serif; font-size:1rem; font-weight:700; cursor:pointer; transition:background 0.2s; margin-top:6px; }
    .login-btn:hover { background:var(--gold); }
    .login-hint { text-align:center; font-size:0.78rem; color:var(--text-light); margin-top:14px; }
    .login-error { color:var(--danger); font-size:0.83rem; text-align:center; margin-top:10px; display:none; }

    /* ADMIN LAYOUT */
    #admin-layout { display:none; min-height:100vh; background:#f7f2ea; }
    .admin-topbar { background:var(--brown); color:var(--white); height:64px; display:flex; align-items:center; justify-content:space-between; padding:0 32px; position:sticky; top:0; z-index:100; box-shadow:0 2px 12px rgba(0,0,0,0.2); }
    .admin-topbar-brand { font-family:'Playfair Display',serif; font-size:1.2rem; }
    .admin-topbar-brand span { color:var(--gold-light); }
    .topbar-right { display:flex; align-items:center; gap:20px; }
    .topbar-link { font-size:0.85rem; color:rgba(255,255,255,0.75); cursor:pointer; transition:color 0.2s; }
    .topbar-link:hover { color:var(--gold-light); }
    .logout-btn { background:rgba(255,255,255,0.12); color:var(--white); border:1px solid rgba(255,255,255,0.25); border-radius:20px; padding:6px 18px; font-size:0.83rem; cursor:pointer; transition:all 0.2s; }
    .logout-btn:hover { background:var(--danger); border-color:var(--danger); }
    .admin-content { padding:36px 32px; max-width:1200px; margin:0 auto; }
    .admin-greeting { font-family:'Playfair Display',serif; font-size:1.7rem; color:var(--brown); margin-bottom:6px; }
    .admin-sub { color:var(--text-light); font-size:0.9rem; margin-bottom:36px; }

    /* TABS */
    .admin-tabs { display:flex; gap:6px; margin-bottom:30px; flex-wrap:wrap; }
    .tab-btn { background:var(--white); border:2px solid var(--beige-dark); border-radius:22px; padding:9px 22px; font-family:'Lato',sans-serif; font-size:0.87rem; font-weight:700; cursor:pointer; color:var(--brown-light); transition:all 0.2s; display:flex; align-items:center; gap:8px; }
    .tab-btn:hover { border-color:var(--gold-light); color:var(--brown); }
    .tab-btn.active { background:var(--brown); color:var(--white); border-color:var(--brown); }
    .tab-panel { display:none; }
    .tab-panel.active { display:block; }

    /* STATS */
    .stats-row { display:grid; grid-template-columns:repeat(4,1fr); gap:20px; margin-bottom:40px; }
    .stat-card { background:var(--white); border-radius:14px; padding:22px 24px; box-shadow:0 3px 14px var(--shadow); }
    .stat-label { font-size:0.78rem; color:var(--text-light); font-weight:600; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:8px; }
    .stat-value { font-family:'Playfair Display',serif; font-size:2rem; color:var(--brown); }
    .stat-icon { float:right; font-size:1.4rem; color:var(--gold-light); margin-top:-4px; }

    /* SECTION CARD */
    .admin-section { background:var(--white); border-radius:16px; padding:28px 28px; margin-bottom:30px; box-shadow:0 3px 14px var(--shadow); }
    .section-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:24px; flex-wrap:wrap; gap:12px; }
    .section-header h2 { font-family:'Playfair Display',serif; font-size:1.25rem; color:var(--brown); }
    .btn { border:none; border-radius:22px; padding:9px 20px; font-family:'Lato',sans-serif; font-weight:700; font-size:0.85rem; cursor:pointer; transition:all 0.2s; display:inline-flex; align-items:center; gap:7px; }
    .btn-primary { background:var(--brown); color:var(--white); }
    .btn-primary:hover { background:var(--gold); }
    .btn-success { background:var(--success); color:var(--white); }
    .btn-success:hover { background:#1e6b38; }
    .btn-danger { background:var(--danger); color:var(--white); }
    .btn-danger:hover { background:#aa2222; }
    .btn-warning { background:var(--gold); color:var(--white); }
    .btn-warning:hover { background:var(--gold-light); }
    .btn-sm { padding:6px 14px; font-size:0.8rem; border-radius:16px; }

    /* TABLE */
    .admin-table { width:100%; border-collapse:collapse; font-size:0.88rem; }
    .admin-table th { text-align:left; padding:10px 14px; background:var(--beige-mid); color:var(--brown-light); font-size:0.78rem; text-transform:uppercase; letter-spacing:0.5px; }
    .admin-table td { padding:12px 14px; border-bottom:1px solid var(--beige-mid); vertical-align:middle; color:var(--text); }
    .admin-table tr:last-child td { border-bottom:none; }
    .admin-table tr:hover td { background:#fdfaf4; }
    .coffee-thumb { width:48px; height:48px; border-radius:8px; object-fit:cover; background:linear-gradient(135deg,#d4a843,#8b5e3c); display:flex; align-items:center; justify-content:center; font-size:1.3rem; overflow:hidden; }
    .coffee-thumb img { width:100%; height:100%; object-fit:cover; }
    .notes-pill { background:var(--beige-mid); color:var(--brown-light); padding:2px 8px; border-radius:10px; font-size:0.75rem; margin-right:4px; display:inline-block; margin-bottom:2px; }
    .status-pill { padding:3px 10px; border-radius:12px; font-size:0.75rem; font-weight:700; }
    .status-active { background:#d4edda; color:#1a6b38; }
    .status-inactive { background:#f8d7da; color:#8b1a1a; }

    /* MODAL */
    .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:2000; display:none; align-items:center; justify-content:center; padding:20px; }
    .modal-overlay.open { display:flex; }
    .modal-box { background:var(--white); border-radius:18px; max-width:600px; width:100%; padding:34px 32px; max-height:90vh; overflow-y:auto; box-shadow:0 20px 60px rgba(0,0,0,0.3); }
    .modal-box h2 { font-family:'Playfair Display',serif; color:var(--brown); margin-bottom:24px; font-size:1.3rem; }
    .form-row { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:16px; }
    .form-row-full { margin-bottom:16px; }
    .form-group { margin-bottom:0; }
    textarea.form-control { height:80px; resize:vertical; }
    .img-preview { width:80px; height:80px; border-radius:10px; background:linear-gradient(135deg,#d4a843,#8b5e3c); display:flex; align-items:center; justify-content:center; font-size:2rem; overflow:hidden; margin-top:8px; }
    .img-preview img { width:100%; height:100%; object-fit:cover; }
    .modal-actions { display:flex; gap:12px; justify-content:flex-end; margin-top:24px; }

    /* PROMO SPECIFIC */
    .promo-stats { display:grid; grid-template-columns:repeat(3,1fr); gap:16px; margin-bottom:24px; }
    .promo-stat { background:var(--beige); border-radius:12px; padding:16px 20px; text-align:center; }
    .promo-stat .val { font-family:'Playfair Display',serif; font-size:1.6rem; color:var(--brown); }
    .promo-stat .lbl { font-size:0.78rem; color:var(--text-light); margin-top:4px; }
    .copy-btn { background:var(--beige-dark); border:none; border-radius:8px; padding:4px 10px; font-size:0.75rem; cursor:pointer; color:var(--brown-light); font-weight:600; transition:background 0.2s; margin-left:6px; }
    .copy-btn:hover { background:var(--gold-light); color:var(--white); }

    /* PAYMENT GATEWAY */
    .pg-card { border:2px solid var(--beige-dark); border-radius:14px; padding:22px; margin-bottom:16px; cursor:pointer; transition:all 0.2s; position:relative; }
    .pg-card.active { border-color:var(--gold); background:#fff9ef; }
    .pg-card h3 { font-family:'Playfair Display',serif; color:var(--brown); font-size:1rem; margin-bottom:6px; }
    .pg-card p { font-size:0.83rem; color:var(--text-light); line-height:1.55; }
    .pg-badge { position:absolute; top:12px; right:12px; color:var(--white); font-size:0.7rem; font-weight:700; padding:3px 10px; border-radius:12px; text-transform:uppercase; }
    .pg-coming { background:var(--brown-light); }
    .pg-live { background:var(--success); }
    .key-field { background:var(--beige); border:2px solid var(--beige-dark); border-radius:10px; padding:10px 14px; font-family:monospace; font-size:0.85rem; color:var(--text); width:100%; margin-top:8px; outline:none; }
    .key-field:focus { border-color:var(--gold); }

    /* TOAST */
    .toast-admin { position:fixed; bottom:28px; right:28px; background:var(--brown); color:var(--white); padding:12px 24px; border-radius:24px; font-size:0.88rem; font-weight:600; z-index:3000; transform:translateY(80px); transition:transform 0.3s; pointer-events:none; }
    .toast-admin.show { transform:translateY(0); }
    .toast-admin.success { background:var(--success); }
    .toast-admin.danger { background:var(--danger); }

    @media(max-width:768px) {
      .stats-row, .promo-stats { grid-template-columns:repeat(2,1fr); }
      .form-row { grid-template-columns:1fr; }
      .admin-content { padding:20px 16px; }
    }
  </style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">Five<span>Roam</span> Coffee</div>
    <div class="login-sub">Admin Panel Â· Secure Login</div>
    <div class="form-group">
      <label>Username</label>
      <input type="text" class="form-control" id="login-user" placeholder="admin" />
    </div>
    <div class="form-group">
      <label>Password</label>
      <input type="password" class="form-control" id="login-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')doLogin()" />
    </div>
    <button class="login-btn" onclick="doLogin()"><i class="fas fa-lock"></i> Sign In</button>
    <div class="login-hint">Default: admin / fiveroam2026</div>
    <div class="login-error" id="login-error">Incorrect username or password.</div>
  </div>
</div>

<!-- ADMIN LAYOUT -->
<div id="admin-layout">
  <div class="admin-topbar">
    <div class="admin-topbar-brand"><i class="fas fa-coffee" style="margin-right:10px;color:var(--gold-light)"></i>Five<span>Roam</span> Admin</div>
    <div class="topbar-right">
      <a href="index.html" class="topbar-link" target="_blank"><i class="fas fa-external-link-alt"></i> View Store</a>
      <button class="logout-btn" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
    </div>
  </div>

  <div class="admin-content">
    <div class="admin-greeting">Welcome back, Admin ðŸ‘‹</div>
    <div class="admin-sub">Manage your coffee catalogue, promo codes, and payment settings.</div>

    <!-- STATS -->
    <div class="stats-row" id="stats-row"></div>

    <!-- TABS -->
    <div class="admin-tabs">
      <button class="tab-btn active" onclick="switchTab('tab-coffees',this)"><i class="fas fa-coffee"></i> Coffee Catalogue</button>
      <button class="tab-btn" onclick="switchTab('tab-promos',this)"><i class="fas fa-percent"></i> Promo Codes</button>
      <button class="tab-btn" onclick="switchTab('tab-discount',this)"><i class="fas fa-tag"></i> Discount Settings</button>
      <button class="tab-btn" onclick="switchTab('tab-payment',this)"><i class="fas fa-credit-card"></i> Payment Gateway</button>
    </div>

    <!-- TAB: COFFEES -->
    <div class="tab-panel active" id="tab-coffees">
      <div class="admin-section">
        <div class="section-header">
          <h2><i class="fas fa-coffee" style="color:var(--gold);margin-right:10px"></i>Coffee Catalogue</h2>
          <button class="btn btn-primary" onclick="openCoffeeModal()"><i class="fas fa-plus"></i> Add New Coffee</button>
        </div>
        <div style="overflow-x:auto">
          <table class="admin-table" id="admin-coffee-table">
            <thead>
              <tr><th>Image</th><th>Estate</th><th>Name</th><th>Process</th><th>Taste Notes</th><th>Price (â‚¹)</th><th>Actions</th></tr>
            </thead>
            <tbody id="admin-table-body"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- TAB: PROMO CODES -->
    <div class="tab-panel" id="tab-promos">
      <div class="admin-section">
        <div class="section-header">
          <h2><i class="fas fa-percent" style="color:var(--gold);margin-right:10px"></i>Promo / Influencer Codes</h2>
          <button class="btn btn-primary" onclick="openPromoModal()"><i class="fas fa-plus"></i> Create Promo Code</button>
        </div>
        <p style="color:var(--text-light);font-size:0.87rem;margin-bottom:20px;line-height:1.65">
          Assign unique promo codes to influencers. When a customer uses their code at checkout, a discount is applied automatically. Track usage to measure influencer performance.
        </p>
        <div class="promo-stats" id="promo-stats"></div>
        <div style="overflow-x:auto">
          <table class="admin-table" id="promo-table">
            <thead>
              <tr><th>Code</th><th>Influencer / Assignee</th><th>Discount %</th><th>Uses</th><th>Status</th><th>Notes</th><th>Actions</th></tr>
            </thead>
            <tbody id="promo-table-body"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- TAB: DISCOUNT -->
    <div class="tab-panel" id="tab-discount">
      <div class="admin-section">
        <div class="section-header">
          <h2><i class="fas fa-tag" style="color:var(--gold);margin-right:10px"></i>Multi-Pack Discount Settings</h2>
        </div>
        <div style="display:flex;align-items:center;gap:20px;flex-wrap:wrap">
          <div>
            <label style="display:block;font-size:0.82rem;font-weight:600;color:var(--brown-light);margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px">Threshold (min packets)</label>
            <input type="number" class="form-control" id="discount-threshold" value="2" min="2" style="width:160px" />
          </div>
          <div>
            <label style="display:block;font-size:0.82rem;font-weight:600;color:var(--brown-light);margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px">Discount Percentage (%)</label>
            <input type="number" class="form-control" id="discount-pct" value="10" min="1" max="50" style="width:160px" />
          </div>
          <button class="btn btn-primary" onclick="saveDiscount()" style="margin-top:26px"><i class="fas fa-save"></i> Save</button>
        </div>
        <p style="font-size:0.82rem;color:var(--text-light);margin-top:16px;padding:12px 16px;background:var(--beige);border-radius:10px">
          When a customer adds <strong id="disc-thresh-display">2</strong> or more packets, a <strong id="disc-pct-display">10%</strong> discount is applied automatically on the cart total. Promo code discounts are applied on top of this.
        </p>
      </div>
    </div>

    <!-- TAB: PAYMENT -->
    <div class="tab-panel" id="tab-payment">
      <div class="admin-section">
        <div class="section-header">
          <h2><i class="fas fa-credit-card" style="color:var(--gold);margin-right:10px"></i>Payment Gateway</h2>
        </div>
        <p style="color:var(--text-light);font-size:0.88rem;margin-bottom:20px;line-height:1.65">Select your preferred gateway and enter your API keys when ready to go live.</p>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;margin-bottom:24px">
          <div class="pg-card active" onclick="selectPG(this,'Razorpay')">
            <span class="pg-badge pg-live">Recommended</span>
            <h3><i class="fas fa-bolt" style="color:var(--gold);margin-right:8px"></i>Razorpay</h3>
            <p>Most popular in India. Supports UPI, Cards, Net Banking, Wallets. Easy integration.</p>
          </div>
          <div class="pg-card" onclick="selectPG(this,'Cashfree')">
            <span class="pg-badge pg-coming">Popular</span>
            <h3><i class="fas fa-coins" style="color:var(--gold);margin-right:8px"></i>Cashfree</h3>
            <p>Fast settlements, UPI, cards and international payments supported.</p>
          </div>
          <div class="pg-card" onclick="selectPG(this,'PayU')">
            <span class="pg-badge pg-coming">Option</span>
            <h3><i class="fas fa-wallet" style="color:var(--gold);margin-right:8px"></i>PayU</h3>
            <p>Trusted gateway with robust analytics and fraud protection.</p>
          </div>
        </div>
        <div class="admin-section" style="background:var(--beige);box-shadow:none;border:1px solid var(--beige-dark);padding:22px">
          <h3 style="font-family:Playfair Display,serif;color:var(--brown);margin-bottom:16px;font-size:1rem" id="pg-title">Razorpay â€“ API Keys</h3>
          <div class="form-row">
            <div class="form-group">
              <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Key ID</label>
              <input type="text" class="key-field" id="pg-key-id" placeholder="rzp_live_XXXXXXXXXXXX" />
            </div>
            <div class="form-group">
              <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Key Secret</label>
              <input type="password" class="key-field" id="pg-key-secret" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
            </div>
          </div>
          <div style="margin-bottom:14px">
            <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Webhook Secret (optional)</label>
            <input type="text" class="key-field" id="pg-webhook" placeholder="whsec_XXXXXXXXXX" />
          </div>
          <button class="btn btn-success" onclick="savePGKeys()"><i class="fas fa-save"></i> Save Keys</button>
          <p style="font-size:0.75rem;color:var(--text-light);margin-top:10px"><i class="fas fa-info-circle"></i> Keys are stored in your browser's localStorage. Move to a secure backend for production.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- COFFEE MODAL -->
<div class="modal-overlay" id="coffee-modal">
  <div class="modal-box">
    <h2 id="coffee-modal-title"><i class="fas fa-coffee" style="color:var(--gold);margin-right:10px"></i>Add New Coffee</h2>
    <input type="hidden" id="edit-id" value="" />
    <!-- CHANGE 1: No lot number field -->
    <div class="form-row">
      <div class="form-group">
        <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Estate Name *</label>
        <input type="text" class="form-control" id="f-estate" placeholder="e.g. Bison Valley Estate" />
      </div>
      <div class="form-group">
        <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Price â‚¹ (per 100g) *</label>
        <input type="number" class="form-control" id="f-price" placeholder="e.g. 599" />
      </div>
    </div>
    <div class="form-row-full">
      <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Coffee Name *</label>
      <input type="text" class="form-control" id="f-name" placeholder="e.g. Bison Valley Bright" />
    </div>
    <div class="form-row-full">
      <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Process Method *</label>
      <input type="text" class="form-control" id="f-process" placeholder="e.g. Double Fermentation Extended Slow Dry" />
    </div>
    <div class="form-row">
      <div class="form-group">
        <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Acidity</label>
        <input type="text" class="form-control" id="f-acidity" placeholder="e.g. Refreshing, bright" />
      </div>
      <div class="form-group">
        <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Body</label>
        <input type="text" class="form-control" id="f-body" placeholder="e.g. Well rounded, smooth" />
      </div>
    </div>
    <div class="form-row-full">
      <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Taste Notes (comma-separated)</label>
      <input type="text" class="form-control" id="f-notes" placeholder="Golden Kiwi, White Chocolate, Mandarin Orange" />
    </div>
    <div class="form-row-full">
      <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Coffee Image URL</label>
      <input type="text" class="form-control" id="f-img-url" placeholder="https://example.com/coffee.jpg" oninput="updateImgPreview(this.value)" />
    </div>
    <div class="form-row-full">
      <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Or Upload Image File</label>
      <input type="file" class="form-control" id="f-img-file" accept="image/*" onchange="handleImgUpload(this)" />
      <div class="img-preview" id="img-preview">â˜•</div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-danger" onclick="closeCoffeeModal()"><i class="fas fa-times"></i> Cancel</button>
      <button class="btn btn-success" onclick="saveCoffee()"><i class="fas fa-save"></i> Save Coffee</button>
    </div>
  </div>
</div>

<!-- PROMO MODAL -->
<div class="modal-overlay" id="promo-modal">
  <div class="modal-box" style="max-width:480px">
    <h2 id="promo-modal-title"><i class="fas fa-percent" style="color:var(--gold);margin-right:10px"></i>Create Promo Code</h2>
    <input type="hidden" id="promo-edit-id" value="" />
    <div class="form-row-full">
      <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Promo Code * <span style="font-weight:400;text-transform:none;color:var(--text-light)">(customers enter this at checkout)</span></label>
      <input type="text" class="form-control" id="p-code" placeholder="e.g. RIYA15 or COFFEE10" style="text-transform:uppercase;letter-spacing:1px;font-weight:700" oninput="this.value=this.value.toUpperCase()" />
    </div>
    <div class="form-row">
      <div class="form-group">
        <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Influencer / Assignee *</label>
        <input type="text" class="form-control" id="p-influencer" placeholder="e.g. Riya Sharma" />
      </div>
      <div class="form-group">
        <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Discount % *</label>
        <input type="number" class="form-control" id="p-discount" placeholder="e.g. 15" min="1" max="50" />
      </div>
    </div>
    <div class="form-row-full">
      <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Notes / Platform</label>
      <input type="text" class="form-control" id="p-notes" placeholder="e.g. Instagram influencer, 50K followers" />
    </div>
    <div class="form-row-full">
      <label style="display:block;font-size:0.78rem;font-weight:700;color:var(--brown-light);text-transform:uppercase;margin-bottom:7px">Status</label>
      <select class="form-control" id="p-active">
        <option value="true">Active</option>
        <option value="false">Inactive</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="btn btn-danger" onclick="closePromoModal()"><i class="fas fa-times"></i> Cancel</button>
      <button class="btn btn-success" onclick="savePromo()"><i class="fas fa-save"></i> Save Code</button>
    </div>
  </div>
</div>

<div class="toast-admin" id="admin-toast"></div>

<script>
  // â”€â”€ AUTH â”€â”€
  function doLogin() {
    const u = document.getElementById('login-user').value.trim();
    const p = document.getElementById('login-pass').value.trim();
    const err = document.getElementById('login-error');
    if (u === 'admin' && p === 'fiveroam2026') {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('admin-layout').style.display = 'block';
      loadAdmin();
    } else {
      err.style.display = 'block';
      setTimeout(()=>err.style.display='none',3000);
    }
  }
  function doLogout() {
    document.getElementById('login-screen').style.display = 'flex';
    document.getElementById('admin-layout').style.display = 'none';
    document.getElementById('login-user').value = '';
    document.getElementById('login-pass').value = '';
  }

  // â”€â”€ TABS â”€â”€
  function switchTab(tabId, btn) {
    document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    btn.classList.add('active');
  }

  // â”€â”€ DATA â”€â”€
  const DEFAULT_COFFEES = [
    { id:1, estate:"Bison Valley Estate", name:"Bison Valley Bright", process:"Double Fermentation", acidity:"Refreshing, bright", body:"Well rounded, smooth", notes:["Golden Kiwi","White Chocolate","Mandarin Orange","Sweet"], price:599, img:"" },
    { id:2, estate:"Stanmore Estate", name:"Stanmore Triple ICE", process:"Triple Fermentation ICE Blast", acidity:"Bright, sweet", body:"Medium", notes:["Complex Fruits","Jaggery","Dates","Dark Fruits","Black Currant"], price:699, img:"" },
    { id:3, estate:"Hidden Falls Estate", name:"Hidden Falls Effervescent", process:"Double Fermentation", acidity:"Sweet, effervescent", body:"Syrupy, Medium+", notes:["Muscat Grapes","Hibiscus","Dark Chocolate","Almond","Cocoa"], price:649, img:"" },
    { id:4, estate:"Orchardale Estate", name:"Orchardale Watermelon", process:"Watermelon Process", acidity:"Sweet / Tart", body:"Light but silky", notes:["Red Currant","Mandarin Orange","Honeysuckle","Floral"], price:625, img:"" },
    { id:5, estate:"Bison Valley Estate", name:"Bison Valley Brown Sugar", process:"Brown Sugar Process", acidity:"Medium+, Intense", body:"Medium", notes:["Brown Sugar","Berries","Nuts","Complex"], price:675, img:"" },
    { id:6, estate:"Moganad Estate", name:"Moganad Triple ICE", process:"Triple Fermentation ICE Blast", acidity:"Complex", body:"Medium, well rounded", notes:["Mulberry","Peach","Palm Sugar","Dried Fig","Elderflower"], price:699, img:"" },
    { id:7, estate:"Stanmore Estate", name:"Stanmore Watermelon", process:"Watermelon Process", acidity:"Sweet / Medium", body:"Velvety, smooth", notes:["Lavender","Rose Hip","Baking Chocolate","Chocolatey"], price:649, img:"" },
    { id:8, estate:"Orchardale Estate", name:"Orchardale Hazelnut", process:"Watermelon Process", acidity:"Bright / Sweet", body:"Medium+", notes:["Hazelnut","Milk Chocolate","Honey","Cocoa","Lime Zest"], price:625, img:"" }
  ];

  function getCoffees() { return JSON.parse(localStorage.getItem('frc_coffees')||'null')||DEFAULT_COFFEES; }
  function saveCoffees(d) { localStorage.setItem('frc_coffees',JSON.stringify(d)); }
  function getPromos() { return JSON.parse(localStorage.getItem('frc_promos')||'[]'); }
  function savePromos(d) { localStorage.setItem('frc_promos',JSON.stringify(d)); }

  function loadAdmin() {
    renderStats(); renderTable(); renderPromos();
    const disc = JSON.parse(localStorage.getItem('frc_discount')||'{"threshold":2,"pct":10}');
    document.getElementById('discount-threshold').value = disc.threshold;
    document.getElementById('discount-pct').value = disc.pct;
    document.getElementById('disc-thresh-display').textContent = disc.threshold;
    document.getElementById('disc-pct-display').textContent = disc.pct + '%';
    const pgKeys = JSON.parse(localStorage.getItem('frc_pg_keys')||'{}');
    if (pgKeys.keyId) document.getElementById('pg-key-id').value = pgKeys.keyId;
    if (pgKeys.keySecret) document.getElementById('pg-key-secret').value = pgKeys.keySecret;
    if (pgKeys.webhook) document.getElementById('pg-webhook').value = pgKeys.webhook;
  }

  function renderStats() {
    const coffees = getCoffees();
    const promos = getPromos();
    const activePromos = promos.filter(p=>p.active).length;
    const totalUses = promos.reduce((s,p)=>s+(p.uses||0),0);
    const estates = [...new Set(coffees.map(c=>c.estate))].length;
    document.getElementById('stats-row').innerHTML = `
      <div class="stat-card"><div class="stat-label"><i class="stat-icon fas fa-coffee"></i>Total Coffees</div><div class="stat-value">${coffees.length}</div></div>
      <div class="stat-card"><div class="stat-label"><i class="stat-icon fas fa-map-marker-alt"></i>Estates</div><div class="stat-value">${estates}</div></div>
      <div class="stat-card"><div class="stat-label"><i class="stat-icon fas fa-percent"></i>Active Promos</div><div class="stat-value">${activePromos}</div></div>
      <div class="stat-card"><div class="stat-label"><i class="stat-icon fas fa-users"></i>Promo Uses</div><div class="stat-value">${totalUses}</div></div>`;
  }

  // â”€â”€ COFFEE TABLE â”€â”€
  function renderTable() {
    const coffees = getCoffees();
    const tbody = document.getElementById('admin-table-body');
    tbody.innerHTML = '';
    coffees.forEach(c => {
      const tr = document.createElement('tr');
      const thumb = c.img ? `<div class="coffee-thumb"><img src="${c.img}" alt="${c.name}"></div>` : `<div class="coffee-thumb">â˜•</div>`;
      const notePills = c.notes.map(n=>`<span class="notes-pill">${n}</span>`).join('');
      tr.innerHTML = `
        <td>${thumb}</td>
        <td>${c.estate}</td>
        <td><strong>${c.name}</strong></td>
        <td style="font-size:0.82rem">${c.process}</td>
        <td>${notePills}</td>
        <td><strong>â‚¹${c.price}</strong></td>
        <td>
          <button class="btn btn-primary btn-sm" onclick="openCoffeeModal(${c.id})"><i class="fas fa-edit"></i> Edit</button>
          <button class="btn btn-danger btn-sm" style="margin-top:4px" onclick="deleteCoffee(${c.id})"><i class="fas fa-trash"></i> Del</button>
        </td>`;
      tbody.appendChild(tr);
    });
  }

  // â”€â”€ COFFEE MODAL â”€â”€
  let imgDataUrl = '';
  function openCoffeeModal(id) {
    imgDataUrl = '';
    document.getElementById('img-preview').innerHTML = 'â˜•';
    document.getElementById('f-img-url').value = '';
    document.getElementById('f-img-file').value = '';
    if (id) {
      const c = getCoffees().find(x=>x.id===id);
      document.getElementById('coffee-modal-title').innerHTML = '<i class="fas fa-edit" style="color:var(--gold);margin-right:10px"></i>Edit Coffee';
      document.getElementById('edit-id').value = id;
      document.getElementById('f-estate').value = c.estate;
      document.getElementById('f-name').value = c.name;
      document.getElementById('f-process').value = c.process;
      document.getElementById('f-acidity').value = c.acidity;
      document.getElementById('f-body').value = c.body;
      document.getElementById('f-notes').value = c.notes.join(', ');
      document.getElementById('f-price').value = c.price;
      if (c.img) { document.getElementById('f-img-url').value = c.img; updateImgPreview(c.img); }
    } else {
      document.getElementById('coffee-modal-title').innerHTML = '<i class="fas fa-plus" style="color:var(--gold);margin-right:10px"></i>Add New Coffee';
      document.getElementById('edit-id').value = '';
      ['f-estate','f-name','f-process','f-acidity','f-body','f-notes','f-price'].forEach(id=>document.getElementById(id).value='');
    }
    document.getElementById('coffee-modal').classList.add('open');
  }
  function closeCoffeeModal() { document.getElementById('coffee-modal').classList.remove('open'); }

  function updateImgPreview(url) {
    const prev = document.getElementById('img-preview');
    prev.innerHTML = url ? `<img src="${url}" alt="preview">` : 'â˜•';
  }
  function handleImgUpload(input) {
    const file = input.files[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = e => { imgDataUrl = e.target.result; document.getElementById('img-preview').innerHTML = `<img src="${imgDataUrl}" alt="preview">`; };
    reader.readAsDataURL(file);
  }
  function saveCoffee() {
    const estate = document.getElementById('f-estate').value.trim();
    const name = document.getElementById('f-name').value.trim();
    const process = document.getElementById('f-process').value.trim();
    const acidity = document.getElementById('f-acidity').value.trim();
    const body = document.getElementById('f-body').value.trim();
    const notesRaw = document.getElementById('f-notes').value.trim();
    const price = parseInt(document.getElementById('f-price').value);
    const imgUrl = document.getElementById('f-img-url').value.trim();
    if (!estate||!name||!process||!price) { showAdminToast('Please fill all required fields.','danger'); return; }
    const notes = notesRaw ? notesRaw.split(',').map(n=>n.trim()).filter(Boolean) : [];
    const img = imgDataUrl||imgUrl||'';
    const coffees = getCoffees();
    const editId = document.getElementById('edit-id').value;
    if (editId) {
      const idx = coffees.findIndex(c=>c.id===parseInt(editId));
      coffees[idx] = { id:parseInt(editId), estate, name, process, acidity, body, notes, price, img };
      showAdminToast('Coffee updated!','success');
    } else {
      const newId = coffees.length ? Math.max(...coffees.map(c=>c.id))+1 : 1;
      coffees.push({ id:newId, estate, name, process, acidity, body, notes, price, img });
      showAdminToast('Coffee added!','success');
    }
    saveCoffees(coffees); closeCoffeeModal(); renderStats(); renderTable();
  }
  function deleteCoffee(id) {
    if (!confirm('Delete this coffee?')) return;
    saveCoffees(getCoffees().filter(c=>c.id!==id));
    renderStats(); renderTable(); showAdminToast('Coffee deleted.','danger');
  }

  // â”€â”€ PROMO CODES â”€â”€
  function renderPromos() {
    const promos = getPromos();
    const active = promos.filter(p=>p.active).length;
    const totalUses = promos.reduce((s,p)=>s+(p.uses||0),0);
    document.getElementById('promo-stats').innerHTML = `
      <div class="promo-stat"><div class="val">${promos.length}</div><div class="lbl">Total Codes</div></div>
      <div class="promo-stat"><div class="val">${active}</div><div class="lbl">Active Codes</div></div>
      <div class="promo-stat"><div class="val">${totalUses}</div><div class="lbl">Total Uses</div></div>`;
    const tbody = document.getElementById('promo-table-body');
    tbody.innerHTML = '';
    if (promos.length === 0) {
      tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;color:var(--text-light);padding:30px">No promo codes yet. Create one above!</td></tr>';
      return;
    }
    promos.forEach((p,idx) => {
      const tr = document.createElement('tr');
      const statusPill = p.active
        ? '<span class="status-pill status-active">Active</span>'
        : '<span class="status-pill status-inactive">Inactive</span>';
      tr.innerHTML = `
        <td><strong style="letter-spacing:1px;font-size:0.95rem">${p.code}</strong><button class="copy-btn" onclick="copyCode('${p.code}')"><i class="fas fa-copy"></i> Copy</button></td>
        <td>${p.influencer}</td>
        <td><strong>${p.discount}%</strong></td>
        <td>${p.uses||0}</td>
        <td>${statusPill}</td>
        <td style="font-size:0.82rem;color:var(--text-light)">${p.notes||'â€”'}</td>
        <td>
          <button class="btn btn-primary btn-sm" onclick="openPromoModal(${idx})"><i class="fas fa-edit"></i> Edit</button>
          <button class="btn btn-danger btn-sm" style="margin-top:4px" onclick="deletePromo(${idx})"><i class="fas fa-trash"></i> Del</button>
        </td>`;
      tbody.appendChild(tr);
    });
  }

  function openPromoModal(idx) {
    document.getElementById('promo-edit-id').value = (idx !== undefined) ? idx : '';
    if (idx !== undefined) {
      const p = getPromos()[idx];
      document.getElementById('promo-modal-title').innerHTML = '<i class="fas fa-edit" style="color:var(--gold);margin-right:10px"></i>Edit Promo Code';
      document.getElementById('p-code').value = p.code;
      document.getElementById('p-influencer').value = p.influencer;
      document.getElementById('p-discount').value = p.discount;
      document.getElementById('p-notes').value = p.notes||'';
      document.getElementById('p-active').value = p.active ? 'true' : 'false';
    } else {
      document.getElementById('promo-modal-title').innerHTML = '<i class="fas fa-plus" style="color:var(--gold);margin-right:10px"></i>Create Promo Code';
      ['p-code','p-influencer','p-discount','p-notes'].forEach(id=>document.getElementById(id).value='');
      document.getElementById('p-active').value = 'true';
    }
    document.getElementById('promo-modal').classList.add('open');
  }
  function closePromoModal() { document.getElementById('promo-modal').classList.remove('open'); }

  function savePromo() {
    const code = document.getElementById('p-code').value.trim().toUpperCase();
    const influencer = document.getElementById('p-influencer').value.trim();
    const discount = parseInt(document.getElementById('p-discount').value);
    const notes = document.getElementById('p-notes').value.trim();
    const active = document.getElementById('p-active').value === 'true';
    if (!code||!influencer||!discount) { showAdminToast('Please fill all required fields.','danger'); return; }
    const promos = getPromos();
    const editIdx = document.getElementById('promo-edit-id').value;
    if (editIdx !== '') {
      promos[parseInt(editIdx)] = { code, influencer, discount, notes, active, uses: promos[parseInt(editIdx)].uses||0 };
      showAdminToast('Promo code updated!','success');
    } else {
      const exists = promos.find(p=>p.code===code);
      if (exists) { showAdminToast('Code already exists!','danger'); return; }
      promos.push({ code, influencer, discount, notes, active, uses:0 });
      showAdminToast('Promo code created!','success');
    }
    savePromos(promos); closePromoModal(); renderStats(); renderPromos();
  }

  function deletePromo(idx) {
    if (!confirm('Delete this promo code?')) return;
    const promos = getPromos(); promos.splice(idx,1);
    savePromos(promos); renderStats(); renderPromos();
    showAdminToast('Promo code deleted.','danger');
  }

  function copyCode(code) {
    navigator.clipboard.writeText(code).then(()=>showAdminToast(`Copied "${code}" to clipboard!`,'success'));
  }

  // â”€â”€ PAYMENT GATEWAY â”€â”€
  let selectedPGName = 'Razorpay';
  function selectPG(el, name) {
    document.querySelectorAll('.pg-card').forEach(c=>c.classList.remove('active'));
    el.classList.add('active'); selectedPGName = name;
    document.getElementById('pg-title').textContent = name + ' â€“ API Keys';
  }
  function savePGKeys() {
    const keyId = document.getElementById('pg-key-id').value.trim();
    const keySecret = document.getElementById('pg-key-secret').value.trim();
    const webhook = document.getElementById('pg-webhook').value.trim();
    localStorage.setItem('frc_pg_keys', JSON.stringify({ gateway:selectedPGName, keyId, keySecret, webhook }));
    showAdminToast('Payment keys saved!','success');
  }

  // â”€â”€ DISCOUNT â”€â”€
  function saveDiscount() {
    const threshold = parseInt(document.getElementById('discount-threshold').value)||2;
    const pct = parseInt(document.getElementById('discount-pct').value)||10;
    localStorage.setItem('frc_discount', JSON.stringify({ threshold, pct }));
    document.getElementById('disc-thresh-display').textContent = threshold;
    document.getElementById('disc-pct-display').textContent = pct + '%';
    showAdminToast('Discount settings saved!','success');
  }

  // â”€â”€ TOAST â”€â”€
  function showAdminToast(msg, type='') {
    const t = document.getElementById('admin-toast');
    t.textContent = msg; t.className = 'toast-admin show ' + type;
    setTimeout(()=>t.className='toast-admin',3500);
  }
</script>
</body>
</html>'''

with open('/tmp/admin.html', 'w', encoding='utf-8') as f:
    f.write(admin_html)
print("admin.html written:", len(admin_html), "chars")
